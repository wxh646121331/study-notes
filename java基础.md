# 1 网络编程

## 1.1 概述

- java是Internet上的语言，它从语言级上提供了对网络应用程序的支持，程序员能够很容易开发常见的网络应用程序

- java提供的网络类库，可以实现无痛的网络连接，联网的底层细节被隐藏在java的本机安装系统里，由JVM进行控制，并且java实现了跨平台的网络库，程序员面对的是一个统一的网络编程环境。

- 计算机网络：把分布在不同地理区域的计算机与专门的外部设备通信线路互连成一个规模大、功能强的网络系统，从面使众多的计算机可以方便地互相传递信息、共享硬件、软件、数据信息等资源。

- 网络编程的目的：直接或间接地通过网络协议与其它计算机进行通讯。

- 网络编程中的两个主要问题：

  - 如何准确地定位网络上一台式多台主机

    - 通信双方地址

    - 一定的规则 

      | 模型                       | 说明                                   |
      | -------------------------- | -------------------------------------- |
      | OSI参考模型                | 过于理想化，未能在因特网上进行广泛推广 |
      | TCP/IP参数模型(TPC/IP协议) | 事实上的国际标准                       |

    - 网络通信协议对比

      | OSI参考模型            | TCP/IP参考模型  | TCP/IP各层对应协议          |
      | ---------------------- | --------------- | --------------------------- |
      | 应用层、表示层、会话层 | 应用层          | HTTP、ftp、telnet、DNS、... |
      | 传输层                 | 传输层          | TCP、UDP、...               |
      | 网络层                 | 网络层          | IP、ICMP、ARP、...          |
      | 数据链路层、物理层     | 物理+数据链路层 | Link                        |

  - 找到主机后如何可靠高效地进行数据传输

    

## 1.2 通讯要素

- IP和端口号
  - IP地址：InetAddress
    - 唯一的标识Internet上的计算机
    - 本地回环地址(hostAddress)：127.0.0.1 主机名(hostName)：localhost
    - 不易记忆
  - 端口号：标识正在计算机上运行的进程(程序)
    - 不同的进程有不同的端口号
    - 被规则为一个16位的整数0~65535。其中，0~1023被预先定义的服务通信占用(如Mysql占用端口3306，http占用端口80等)。除非我们需要访问这些特定服务，否则，就应该使用1024~65535这些端口中的某一个进行通信，以免发生端口冲突
    - 端口号与IP地址的组合得出一个网络套接字。

- 网络通信协议

  - 计算机网络中实现通信必须有一些约定，即通信协议，对速率、传输代码、代码结构、传输控制步骤、出错控制等制定标准

  - 分层思想：由于结点之间联系很复杂，在制定协议时，把复杂成份分解成一些简单的成份，再将它们复合起来。最常用的复合方式是层次方式，即同层间可以通信、上一层可以调用下一层，而与再下一层不发生关系。各层互不影响，利于系统的开发和扩展。

  - TCP/IP协议簇

    - 传输层协议中有两个非常重要的协议：

      > TCP：传输控制协议，Transmission Control Protocol
      >
      > UDP：用户数据报协议，User Datagram Protocol

    - TCP/IP以两个主要协议：TCP和IP而得名，实际上是一组协议，包括多个具有不同功能且互为关联的协议

    - IP(Internet Protocol)协议是网线层的主要协议，支持网络间互连的数据通信

    - TCP/IP协议模型从更实用的角度出发，形成了高效的四层体系结构，即：物理链路层、IP层、传输层和应用层

## 1.3 InetAddress类

> InetAddress位于java.net包下
>
> 1. InetAddress用来代表IP地址。一个InetAddress的对象就代表着一个IP地址
> 2. 如何创建InetAddress对象：getByName(String host)
> 3. 获取IP地址对应的域名：getHostName()
> 4. 获取IP地址：getHostAddress()
> 5. 获取本机的IP：getLocalHost()

## 1.4 TCP网络通信

### 1.4.1 TCP协议

- 使用TCP协议前，须先建立TCP连接，形成传输数据通道
- 传输前，采用"三次握手"的方式，是可靠的
- TCP协议进行通信的两个应用进程：客户端、服务端
- 在连接中可进行大数据量的传输
- 传输完毕，需释放已建立的连接，效率低

## 1.5 UDP网络通信

### 1.5.1 UDP协议

- 将数据、源、目的封装成数据包，不需要建立连接
- 每个数据报的大小限制在64k内
- 因无需连接，是不可靠的
- 发送数据结束时无需释放资源，速度快

## 1.6 URL编程

## 1.6.1 Socket

- 利用Socket开发网络应用程序早已被广泛的采用，以至于成为事实上的标准
- 通信的两端都要有Socket，是两台机器间通信的端点
- 网络通信其实就是Socket间的通信
- Socket允许程序把网络连接当成一个流，数据在两个Socket间通过IO传输
- 一般主动发起通信的应用程序叫客户端，等待通信请求的为服务端

### 1.6.2 案例

- Socket客户端

  > 1. 创建一个Socket的对象，通过构造器指明服务端的IP地址及其接收程序的端口号
  >
  >    Socket socket = new Socket(InetAddress.getByName("127.0.0.1"), 9090);
  >
  > 2. getOutputStream()，发送数据，方法返回OutputStream的子类对象
  >
  >    OutputStream os = socket.getOutputStream();
  >
  > 3. 具体的输出过程
  >
  >    os.write("我是客户端".getBytes());
  >
  > 4. 关闭相应的流和socket
  >
  >    os.close();
  >
  >    socket.close();

- Socket服务端

  > 1. 创建一个ServerSocket的对象，通过构造器指明自身的端口号
  >
  >    ServerSocket ss = new ServerSocket(9090);
  >
  > 2. 调用其accept方法，返回一个Socket的对象
  >
  >    Socket s = ss.accept();
  >
  > 3. 调用Socket对象的getInputStream()获取一个从客户端发送过来的输入流
  >
  >    InputStream is = s.getInputStream();
  >
  > 4. 对获取的流进行操作
  >
  >    byte[] b = new byte[20];
  >
  >    int len;
  >
  >    while((len = is.read(b)) != -1){
  >
  >    ​	String str = new String(0,0,len);
  >
  >    ​	System.out.println(str);
  >
  >    }
  >
  > 5. 关闭socket及相应的流
  >
  >    ss.close();
  >
  >    s.close();
  >
  >    is.close();

